<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<header th:replace="~{fragments/commonHeader :: common('Time Series Chart')}">

</header>

<body>

<div th:replace="~{fragments/currentUserFragment :: currentUser}"></div>


<div th:replace="~{fragments/agentStatus :: agentStatus}"></div>

<div class="charts-container">
  <div class="chart-container">
    <canvas id="mttfbChart"></canvas>
  </div>
  <div class="chart-container">
    <canvas id="tpsChart"></canvas>
  </div>
</div>
<script th:inline="javascript">
  /*<![CDATA[*/
  var mttfbCtx = document.getElementById('mttfbChart').getContext('2d');
  var tpsCtx = document.getElementById('tpsChart').getContext('2d');

  // MTTFB 데이터
  var mttfbData = /*[[${mttfbInfoList}]]*/ [];
  var mttfbLabels = mttfbData.map(function(info) {
    var date = new Date(info.timestamp);
    var hours = date.getHours().toString().padStart(2, '0');
    var minutes = date.getMinutes().toString().padStart(2, '0');
    var seconds = date.getSeconds().toString().padStart(2, '0');
    return hours + ":" + minutes + ":" + seconds;
  });
  var mttfbValues = mttfbData.map(function(info) {
    return info.mttbfb;
  });

  var mttfbChart = new Chart(mttfbCtx, {
    type: 'line',
    data: {
      labels: mttfbLabels,
      datasets: [{
        label: 'MTTFB (ms)',
        data: mttfbValues,
        borderColor: 'rgba(75, 192, 192, 1)',
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      // scales: {
      //   xAxes: [{
      //     type: 'time',
      //     ticks: {
      //       autoSkip: true,
      //       maxTicksLimit: 10
      //     }
      //   }],
      //   yAxes: [{
      //     scaleLabel: {
      //       display: true,
      //       labelString: 'MTTFB (ms)'
      //     }
      //   }]
      // }
    }
  });

  // TPS 데이터
  var tpsData = /*[[${tpsInfoList}]]*/ [];
  var tpsLabels = tpsData.map(function(info) {
    var date = new Date(info.timestamp);
    var hours = date.getHours().toString().padStart(2, '0');
    var minutes = date.getMinutes().toString().padStart(2, '0');
    var seconds = date.getSeconds().toString().padStart(2, '0');
    return hours + ":" + minutes + ":" + seconds;
  });
  var tpsValues = tpsData.map(function(info) {
    return info.tps;
  });

  var tpsChart = new Chart(tpsCtx, {
    type: 'line',
    data: {
      labels: tpsLabels,
      datasets: [{
        label: 'TPS',
        data: tpsValues,
        borderColor: 'rgba(192, 75, 192, 1)',
        backgroundColor: 'rgba(192, 75, 192, 0.2)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      // scales: {
      //   xAxes: [{
      //     type: 'time',
      //     ticks: {
      //       autoSkip: true,
      //       maxTicksLimit: 10
      //     }
      //   }],
      //   yAxes: [{
      //     scaleLabel: {
      //       display: true,
      //       labelString: 'TPS'
      //     }
      //   }]
      // }
    }
  });
  /*]]>*/
</script>

<h2>Test Results</h2>
<table>
  <tr>
    <th>Test ID</th>
    <th>Group ID</th>
    <th>Started At</th>
    <th>Finished At</th>
    <th>URL</th>
    <th>Method</th>
    <th>Total Requests</th>
    <th>Total Errors</th>
    <th>Total Success</th>
    <th>Total Users</th>
    <th>Total Duration</th>
    <th>MTTFB Average</th>
    <th>TPS Average</th>
    <th>Test Status</th>
  </tr>
  <tr>
    <td th:text="${commonTestResult.testId}"></td>
    <td th:text="${commonTestResult.groupId}"></td>
    <td th:text="${commonTestResult.startedAt}"></td>
    <td th:text="${commonTestResult.finishedAt}"></td>
    <td th:text="${commonTestResult.url}"></td>
    <td th:text="${commonTestResult.method}"></td>
    <td th:text="${commonTestResult.totalRequests}"></td>
    <td th:text="${commonTestResult.totalErrors}"></td>
    <td th:text="${commonTestResult.totalSuccess}"></td>
    <td th:text="${commonTestResult.totalUsers}"></td>
    <td th:text="${commonTestResult.totalDuration}"></td>
    <td th:text="${commonTestResult.mttfbAverage}"></td>
    <td th:text="${commonTestResult.tpsAverage}"></td>
    <td th:text="${commonTestResult.testStatus}"></td>
  </tr>
</table>

</body>
</html>
